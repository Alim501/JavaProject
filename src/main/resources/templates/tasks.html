<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <style>
        a {
            color: black;
            text-decoration: none;
        }

        a:hover {
            color: black;
        }
    </style>
</head>
<body>


<div class="container mt-5">
    <form th:action="@{/task}" method="get">
        <input type="text" name="search" th:value="${search}" placeholder="Search by title"/>
        <button type="submit">Search</button>
    </form>
    <form th:action="@{/task}" method="get">
        <select id="categorySelect" name="categoryTitle">
            <option value="" disabled th:if="${categories.size() == 0 }" selected>No categories available</option>
            <option value="" selected>Select a category</option>
            <option th:each="category : ${categories}"
                    th:value="${category.name}"
                    th:text="${category.name}">
            </option>
        </select>
        <button type="submit">Search</button>
    </form>
    <!-- Form to Create a Task -->
    <h2>Create Task</h2>
    <form th:action="@{/task}" method="post">
        <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" required></textarea>
        </div>
        <div class="mb-3">
            <label for="dueDate" class="form-label">Due Date</label>
            <input type="date" class="form-control" id="dueDate" name="dueDate" required>
        </div>
        <div class="mb-3">
            <label for="priority" class="form-label">Priority</label>
            <input type="number" class="form-control" id="priority" name="priority" required>
        </div>
        <div class="mb-3">
            <label for="category">Category:</label>
            <select id="category" name="categoryId">
                <option value="" disabled th:if="${categories.size() == 0 }" selected>No categories available</option>
                <option value="" selected>Select a category</option>
                <option th:each="category : ${categories}"
                        th:value="${category.id}"
                        th:text="${category.name}">
                </option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Create Task</button>
    </form>

    <!-- Tasks List -->
    <h3 class="mt-5">Your Tasks</h3>
    <div class="row">
        <div th:if="${tasks != null and !tasks.isEmpty()}" th:each="task : ${tasks}" class="col-md-3">
            <a th:href="@{/task/{id}(id=${task.id})}">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${task.title}"></h5>
                        <p class="card-text" th:text="${task.description}"></p>
                        <p class="card-text">
                            <small class="text-muted" th:text="${task.dueDate}"></small>
                        </p>
                        <p>Category: <span th:text="${task.category.name}"></span></p>
                        <p>Status: <span th:text="${task.status}"></span></p>
                        <p>Priority: <span th:text="${task.priority}"></span></p>
                    </div>
                </div>
            </a>
        </div>
        <div th:if="${tasks == null or tasks.isEmpty()}" class="col-12">
            <div class="alert alert-info">
                You have no tasks.
            </div>
        </div>
    </div>

    <div>
    <span th:if="${tasks.hasPrevious()}">
        <a th:href="@{/task(page=${tasks.number - 1}, search=${search})}">Previous</a>
    </span>

        <span>Page <span th:text="${currentPage + 1}"></span> of <span th:text="${totalPages}"></span></span>

        <span th:if="${tasks.hasNext()}">
        <a th:href="@{/task(page=${tasks.number + 1}, search=${search})}">Next</a>
    </span>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
